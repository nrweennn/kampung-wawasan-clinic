<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Kampung Wawasan Clinic</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #0d6efd 0%, #002244 100%); 
            min-height: 100vh; 
            color: #333; 
        }
        
        /* NAVIGATION */
        .navbar { background-color: white !important; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .navbar-brand { color: #0d6efd !important; font-weight: 700; font-family: 'Orbitron', sans-serif; }
        .nav-link { font-weight: 600; color: #495057 !important; margin: 0 10px; }
        .nav-link.active { color: #0d6efd !important; border-bottom: 2px solid #0d6efd; }

        /* MOBILE MENU ADJUSTMENT */
        @media (max-width: 991px) {
            .nav-link { border-bottom: none !important; padding: 10px 0; }
            .nav-link.active { color: #0d6efd !important; background: #f8f9fa; padding-left: 10px; border-radius: 5px; }
        }

        /* SUMMARY CARDS */
        .summary-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; border-radius: 12px; padding: 15px; text-align: center;
        }
        .summary-num { font-family: 'Orbitron'; font-size: 22px; font-weight: 700; display: block; }

        /* DIRECTORY */
        .sidebar-p { max-height: 75vh; overflow-y: auto; }
        .p-card { 
            cursor: pointer; background: white; border-radius: 8px; margin-bottom: 10px; padding: 12px;
            transition: 0.3s; border-left: 4px solid transparent; overflow: hidden;
        }
        .p-card:hover { transform: translateX(5px); border-left-color: #0d6efd; background-color: #f1f7ff; }
        .name-row { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
        .patient-name { font-size: 11px; font-weight: 700; color: #0d6efd; max-width: 65%; line-height: 1.2; }

        /* BOXES */
        .glass-box { 
            background: rgba(255, 255, 255, 0.98); border-radius: 15px; padding: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 20px; position: relative;
        }
        .label-tech { font-size: 10px; font-weight: 800; color: #888; text-transform: uppercase; border-left: 3px solid #0d6efd; padding-left: 8px; margin-bottom: 5px; }
        .data-value { font-size: 22px; font-weight: 700; color: #0d6efd; }
        
        .status-badge { font-size: 9px; padding: 2px 8px; border-radius: 10px; font-weight: 700; text-transform: uppercase; }
        .status-pending { background: #eee; color: #666; }
        .status-progress { background: #fff3cd; color: #856404; }
        .status-completed { background: #d1e7dd; color: #0f5132; }

        /* MONITOR ANIMATION */
        .cardiogram-box { height: 60px; width: 100%; background: #000; border-radius: 8px; position: relative; overflow: hidden; border: 2px solid #333; }
        .pulse-line { position: absolute; width: 100%; height: 2px; background: #00ff00; top: 50%; box-shadow: 0 0 15px #00ff00; animation: scan 2s infinite linear; }
        @keyframes scan { 0% { left: -100%; } 100% { left: 100%; } }

        #bodyImg { width: 100%; max-height: 380px; object-fit: contain; margin-top: 10px; border-radius: 10px; }
        .lock-overlay { text-align: center; padding: 60px; color: #888; border: 2px dashed #ddd; border-radius: 15px; background: #fdfdfd; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand" href="home.html">✚ Kampung Wawasan Clinic</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#clinicNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="clinicNavbar">
                <ul class="navbar-nav ms-auto text-center">
                    <li class="nav-item"><a class="nav-link active" href="home.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="profiles.html">Doctor Profiles</a></li>
                    <li class="nav-item"><a class="nav-link" href="details.html">Patient Details</a></li>
                    <li class="nav-item"><a class="nav-link" href="editviewstatus.html">Manage Status</a></li>
                    <li class="nav-item"><a class="nav-link text-danger fw-bold" href="index.html">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4 px-4">
        
        <div class="row g-2 g-md-3 mb-4 text-white">
            <div class="col-6 col-md-2"><div class="summary-card"><small>TOTAL</small><span id="statTotal" class="summary-num">0</span></div></div>
            <div class="col-6 col-md-2"><div class="summary-card"><small>FEVER</small><span id="statFever" class="summary-num text-warning">0</span></div></div>
            <div class="col-6 col-md-2"><div class="summary-card"><small>COUGH</small><span id="statCough" class="summary-num text-info">0</span></div></div>
            <div class="col-6 col-md-2"><div class="summary-card"><small>STOMACH</small><span id="statStomach" class="summary-num text-danger">0</span></div></div>
            <div class="col-6 col-md-2"><div class="summary-card"><small>DENTAL</small><span id="statDental" class="summary-num text-primary">0</span></div></div>
            <div class="col-6 col-md-2"><div class="summary-card"><small>COMPLETED</small><span id="statDone" class="summary-num text-success">0</span></div></div>
        </div>

        <div class="row">
            <div class="col-lg-2">
                <h6 class="text-white fw-bold small mb-3">SYSTEM DIRECTORY</h6>
                <div id="pList" class="sidebar-p"></div>
            </div>

            <div class="col-lg-10" id="mainConsole" style="display:none;">
                <div class="text-end mb-2">
                    <button class="btn btn-sm btn-danger fw-bold" onclick="closeConsole()">× CLOSE CONSOLE</button>
                </div>

                <div class="row g-3">
                    <div class="col-lg-4">
                        <div class="glass-box text-center">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span id="dispStatus" class="status-badge">--</span>
                                <small class="text-muted" style="font-size: 10px;">ID: <span id="dispIC">--</span></small>
                            </div>
                            <h4 id="dispName" class="fw-bold text-dark">--</h4>
                            <img id="bodyImg" src="male.jpg" alt="Anatomy">
                        </div>
                        <div class="glass-box">
                            <h6 class="fw-bold text-primary mb-3">APPOINTMENT INFO</h6>
                            <div class="label-tech">Assigned Doctor:</div>
                            <div class="fw-bold" id="vNextDr">--</div>
                            <div class="small text-muted" id="vDate">--</div>
                            <hr>
                            <h6 class="fw-bold mb-2 small text-secondary">MEDICAL HISTORY</h6>
                            <div style="font-size: 11px;" id="historyTxt">General Checkup</div>
                        </div>
                    </div>

                    <div class="col-lg-8">
                        <div id="diagnosticsActive" style="display: none;">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="glass-box">
                                        <h6 class="fw-bold text-danger mb-3">LABORATORY RESULTS</h6>
                                        <div class="row g-2">
                                            <div class="col-6"><div class="label-tech">CRP</div><div id="vCRP" class="fw-bold">--</div></div>
                                            <div class="col-6"><div class="label-tech">WBC</div><div id="vWBC" class="fw-bold">--</div></div>
                                            <div class="col-6"><div class="label-tech">HGB</div><div id="vHGB" class="fw-bold">--</div></div>
                                            <div class="col-6"><div class="label-tech">Glucose</div><div id="vSugar" class="fw-bold">--</div></div>
                                        </div>
                                    </div>
                                    <div class="glass-box">
                                        <h6 class="fw-bold text-success mb-3">HEART RATE MONITOR</h6>
                                        <div class="cardiogram-box"><div class="pulse-line"></div></div>
                                        <div class="row mt-3 text-center">
                                            <div class="col-6"><div class="label-tech">BPM</div><div class="data-value text-success" id="vPulse">--</div></div>
                                            <div class="col-6"><div class="label-tech">BP</div><div class="data-value text-danger" id="vBP">--</div></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="glass-box">
                                        <h6 class="fw-bold text-info mb-3">RESPIRATORY ANALYSIS</h6>
                                        <div class="label-tech">Oxygen Saturation</div>
                                        <div class="lung-bar" style="height:12px; background:#e9ecef; border-radius:10px; overflow:hidden;">
                                            <div id="lungO2" style="height:100%; background:linear-gradient(to right, #00d2ff, #3a7bd5); transition:1.5s; width: 0%"></div>
                                        </div>
                                        <div class="text-end small fw-bold mt-1" id="vOxy">--%</div>
                                        <div class="row g-2 mt-2">
                                            <div class="col-6"><div class="label-tech">Resp Rate</div><div class="data-value" id="vBreath">--</div></div>
                                            <div class="col-6"><div class="label-tech">Temp</div><div class="data-value" id="vTemp">--</div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="diagnosticsLocked" class="lock-overlay bg-white">
                            <div class="h1 mb-3">⌛</div>
                            <h5 class="fw-bold text-dark">WAITING FOR EXAMINATION</h5>
                            <p class="small text-muted">No diagnostic data available. Set status to <b>"In Progress"</b> to begin clinical monitoring.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function loadDirectory() {
            const data = JSON.parse(localStorage.getItem('wawasan_clinic_data')) || [];
            const list = document.getElementById('pList');
            list.innerHTML = '';
            let fever=0, cough=0, stomach=0, dental=0, done=0;

            data.forEach((p, i) => {
                let s = p.status || "Pending";
                let sClass = s === "In Progress" ? "status-progress" : (s === "Completed" ? "status-completed" : "status-pending");
                if (s === "Completed") done++;
                if(p.sakit === "Fever") fever++; if(p.sakit === "Cough") cough++;
                if(p.sakit === "Stomach Pain") stomach++; if(p.sakit === "Dental") dental++;

                list.innerHTML += `
                    <div class="p-card shadow-sm" onclick="runDiagnostics(${i})">
                        <div class="name-row">
                            <div class="patient-name">${p.name.toUpperCase()}</div>
                            <span class="status-badge ${sClass}">${s}</span>
                        </div>
                        <div class="text-muted" style="font-size: 9px; margin-top: 4px;">ID: ${p.ic}</div>
                    </div>`;
            });
            document.getElementById('statTotal').innerText = data.length;
            document.getElementById('statFever').innerText = fever;
            document.getElementById('statCough').innerText = cough;
            document.getElementById('statStomach').innerText = stomach;
            document.getElementById('statDental').innerText = dental;
            document.getElementById('statDone').innerText = done;
        }

        function closeConsole() { document.getElementById('mainConsole').style.display = "none"; }

        function runDiagnostics(i) {
            const data = JSON.parse(localStorage.getItem('wawasan_clinic_data')) || [];
            const p = data[i];
            document.getElementById('mainConsole').style.display = "block";
            
            document.getElementById('dispName').innerText = p.name;
            document.getElementById('dispIC').innerText = p.ic;
            document.getElementById('vNextDr').innerText = p.doctor || "Unassigned";
            document.getElementById('vDate').innerText = "Date: " + (p.date || "N/A");

            const status = p.status || "Pending";
            const statusEl = document.getElementById('dispStatus');
            statusEl.innerText = status;
            statusEl.className = "status-badge " + (status === "In Progress" ? "status-progress" : (status === "Completed" ? "status-completed" : "status-pending"));

            if (status === "In Progress" || status === "Completed") {
                document.getElementById('diagnosticsActive').style.display = "block";
                document.getElementById('diagnosticsLocked').style.display = "none";
                
                document.getElementById('vPulse').innerText = Math.floor(72 + Math.random()*15);
                document.getElementById('vBP').innerText = "120/80";
                document.getElementById('vOxy').innerText = "99%";
                document.getElementById('lungO2').style.width = "99%";
                document.getElementById('vTemp').innerText = "36.7°C";
                document.getElementById('vCRP').innerText = (0.5 + Math.random()).toFixed(1) + " mg";
                document.getElementById('vWBC').innerText = "5.8k";
                document.getElementById('vHGB').innerText = "13.9g";
                document.getElementById('vSugar').innerText = "90mg";
                document.getElementById('vBreath').innerText = "16 bpm";
            } else {
                document.getElementById('diagnosticsActive').style.display = "none";
                document.getElementById('diagnosticsLocked').style.display = "block";
            }

            document.getElementById('bodyImg').src = (p.gender === "Female") ? "photo1.jpg.jfif" : "photo2.jpg.jfif";
            
            // On mobile, auto-scroll down to the console when a patient is clicked
            if (window.innerWidth < 992) {
                window.scrollTo({ top: document.getElementById('mainConsole').offsetTop - 70, behavior: 'smooth' });
            }
        }
        window.onload = loadDirectory;
    </script>
</body>
</html>